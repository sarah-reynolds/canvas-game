<!DOCTYPE html>
<html>
<head>
	<title>Quidditch Practice</title>
	<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
	<style type="text/css" media="screen">
		.margin-left{
			margin-left: 20px;
		}
		.margin-bottom{
			margin-bottom:  10px;
		}
		.center{
			text-align: center;
		}
		.inline{
			display: inline-block;
			margin:  0 30px 30px 30px;
			width: 120px;
		}
		.max-width{
			width: 512px;
		}
		.text-left{
			line-height: 35px;
			font-size: 0.9em;
		}
	</style>
</head>
<body class="center">
	<div class="container max-width">
		
		<div>
			<h2>Quidditch Practice</h2>
		</div>
		
		<div class="row lead">
			<p class="text-left">1. Enter your name.<br/>
			2. Click 'Start game'.<br/>
			3. Catch the snitch.<img src="snitch3.png"><br/>
			4. Avoid the bludger. <img src="bludger3.png"> If you are hit by the bludger, your speed will slow down for 3 seconds.</p>
		</div>
		
		<div class="row margin-bottom">
			<input class="pull-left" id="player-name" type="text" placeholder="Player name">
			<button class="pull-left" onclick="newPlayer()">Enter name</button>
			<button class="pull-right" onclick="startGame()">Start game</button>
		</div>
		
		<div class="row margin-bottom">
			<div class="pull-left"><span id="nameBoard">Your score: </span><span id="score">0</span></div>
			<div class="pull-right" id="timer">Timer: 30 seconds</div>
		</div>		
		
		<div class="row margin-bottom">
			<div class="pull-left" id="hiScore">High score: 0<span id="hiScoreName"></span></div>
		</div>
	
	</div>
			<script type="text/javascript">

		// SET ALL VARIABLES
			
			// create the canvas tag with js. the canvas just holds the game
			var canvas = document.createElement('canvas');
			// create a context gor JS to play with (methods, properties, etc)
			var context = canvas.getContext('2d')
			var gameStart = 0;
			var gameEnd = 0;
			var userScore = 0;
			var highScore = 0;
			var highScoreName = 0;
			var timerInterval;
			var playerArray = [];
			var playerName = "Player"
			// Default name set to "Player" in var above. Push below will add the default user name to playerArray, which tracks all users' scores and names per session (resets on browser refresh). Also add's user's name on the screen. See function newPlayer if user enters their name.
			playerArray.push(new Player(playerName));
				document.getElementById('nameBoard').innerHTML = playerName + "'s score: "
			// Game/canvas background
			var backgroundImage = new Image();
				backgroundImage.src = "background.png";
				canvas.width = 512; 
				canvas.height = 480;
				// add the canvas tag to the dom
				document.body.appendChild(canvas);
			var speedModifier = .7; // Harry's speed
			var snitchSpeed = 2.33; // Snitch's speed
			var bludgerSpeed = 2.33;
			var gameOn = false;
			// var for Harry
			var hero = new Image();
				hero.src = "hp2.png";
				var heroLocation = {
					x: 50,
					y: 50
				}
			// var for snitch
			var snitch = new Image();
				snitch.src = "snitch3.png";
				var snitchLocation = {
					x: 350,
					y: 350,
					newX: 350,
					newY: 350
				}
			// var for bludger
			var bludger = new Image();
				bludger.src = "bludger3.png";
				var bludgerLocation = {
					x: 250,
					y: 250,
					newX: 250,
					newY: 250
				}
			// array to hold all the keys that are currently pressed down
			var keysDown = [];

		// FUNCTIONS

			function Player(name){
				this.name = name;
				this.highscore = 0;
			}

			function newPlayer(){
				var playerNameDiv = document.getElementById('player-name');
				playerName = playerNameDiv.value;
				playerArray.push(new Player(playerName));
				document.getElementById('nameBoard').innerHTML = playerName + "'s score: "

			}

			// startGame function is called when user clicks 'Start game'. Function
			function startGame(){
				gameOn = true;
				// User started the game. Save the time and time plus 30 seconds
				gameStart = Date.now();
				gameEnd = Date.now() + 30000;
				// start timerInterval
				timerInterval = Math.floor(setInterval(updateTimer, 1000));
				userScore = 0;
				// here add document to update your score to reflect 0
				document.getElementById('score').innerHTML = userScore

			}

			function updateTimer() {
				var newNow = Date.now();
				var timeDifference = (gameEnd - newNow) / 1000;
				if(timeDifference < 0){
					clearInterval(timerInterval);
					gameOn = false;
					timeDifference = 0;
					document.getElementById('timer').innerHTML = "Time's up";
					context.font = "30px Arial";
					context.strokeText("Game Over",10,50);
					
				}else{
				document.getElementById('timer').innerHTML = "Timer: " + Math.floor(timeDifference) + " seconds";
				}
			}


				addEventListener('keyup', function(event){
					delete keysDown[event.keyCode];
				});

				// We need a way to tell if the user has pushed the arrow key
				//anonymous function has no name, and is only called if its parents calls it (which here is the keydown event) -- and with it comes an event parameter
				addEventListener('keydown', function(event){
					// if keyDown[39] is true then the user pushed right
					// if keyDown[40] is true then the user pushed down
					// if keyDown[37] is true then the user pushed left
					// if keyDown[38] is true then the user pushed up

					keysDown[event.keyCode] = true;
				})

			// updates Harry's, snitch, and bludger locations
				function update(){
					// user pressed right at some point because it's in the array
					// add if so that it only runs if the location has not reached the end
					//stay inside right
					if(39 in keysDown){
						if(heroLocation.x <= 425){
							heroLocation.x += (10 * speedModifier);
						}
					}
					// stay inside left
					if(37 in keysDown){
						if(heroLocation.x >= 0){
							heroLocation.x -= (10 * speedModifier);
						}
					}
					// stay inside the top
					if(38 in keysDown){
						if(heroLocation.y >= 5){
							heroLocation.y -= (10 * speedModifier);
						}
					}
					//stay inside the bottom
					if(40 in keysDown){
						if(heroLocation.y <= 400){
							heroLocation.y += (10 * speedModifier);
						}
					}

					// move snitch if you touch him
					if(
						(heroLocation.x <= snitchLocation.x + 32)
						&& (heroLocation.y <= snitchLocation.y + 32)
						&& (snitchLocation.x <= heroLocation.x + 32)
						&& (snitchLocation.y <= heroLocation.y + 32)
						){
							userScore++;
						document.getElementById('score').innerHTML = userScore
						if(userScore > highScore){
							highScore = userScore;
							document.getElementById('hiScore').innerHTML = "High score: " + highScore + " (set by " + playerName + ") "
						}
						var currentPlayerIndex = playerArray.length-1;
						if(userScore > playerArray[currentPlayerIndex].highscore){
							playerArray[currentPlayerIndex].highscore = userScore
						}


						// randomize the location of the snitch upon contact
							var random = Math.random() * 450;
							var random2 = Math.random() * 400;
							snitchLocation.x = random;
							snitchLocation.y = random2;
						}

					// move bludger if you touch him
					if(
						(heroLocation.x <= bludgerLocation.x + 25)
						&& (heroLocation.y <= bludgerLocation.y + 25)
						&& (bludgerLocation.x <= heroLocation.x + 25)
						&& (bludgerLocation.y <= heroLocation.y + 25)
						){
							// userScore++;
							// if you hit the bludger, slow down speed for 3 seconds, then return to normal speed
							speedModifier = .1;
							setTimeout(function(){ speedModifier = .7; }, 3000);
						}
				}
				
				// snitch moves randomnly on the page by creating new random coordinates, then 
				function snitchMove(){
					if(gameOn){

						if(
							(snitchLocation.x <= snitchLocation.newX + 32)
							&& (snitchLocation.y <= snitchLocation.newY + 32)
							&& (snitchLocation.newX <= snitchLocation.x + 32)
							&& (snitchLocation.newY <= snitchLocation.y + 32)
							){
							snitchLocation.newX = Math.ceil(Math.random() * 400)
							snitchLocation.newY = Math.ceil(Math.random() * 400)
						}else{
							if(snitchLocation.newX > snitchLocation.x){
								snitchLocation.x += (1 * snitchSpeed)
							}
							if(snitchLocation.newX < snitchLocation.x){
								snitchLocation.x -= (1 * snitchSpeed)
							}
							if(snitchLocation.newY > snitchLocation.y){
								snitchLocation.y += (1 * snitchSpeed)
							}
							if(snitchLocation.newY < snitchLocation.y){
								snitchLocation.y -= (1 * snitchSpeed)
							}
						}
					}
				}

				// have bludger move randomly on the page
				function bludgerMove(){
					if(gameOn){

						if(
							(bludgerLocation.x <= bludgerLocation.newX + 32)
							&& (bludgerLocation.y <= bludgerLocation.newY + 32)
							&& (bludgerLocation.newX <= bludgerLocation.x + 32)
							&& (bludgerLocation.newY <= bludgerLocation.y + 32)
							){
							bludgerLocation.newX = Math.ceil(Math.random() * 400)
							bludgerLocation.newY = Math.ceil(Math.random() * 400)
						}else{
							if(bludgerLocation.newX > bludgerLocation.x){
								bludgerLocation.x += (1 * bludgerSpeed)
							}
							if(bludgerLocation.newX < bludgerLocation.x){
								bludgerLocation.x -= (1 * bludgerSpeed)
							}
							if(bludgerLocation.newY > bludgerLocation.y){
								bludgerLocation.y += (1 * bludgerSpeed)
							}
							if(bludgerLocation.newY < bludgerLocation.y){
								bludgerLocation.y -= (1 * bludgerSpeed)
							}
						}
					}
				}

			// KEEP THIS AT THE BOTTOM
				function draw(){
					if(gameOn){
						update();
					}
					snitchMove();
					bludgerMove();
					// put out bgimage on the context at x=o and y = 0
					context.drawImage(backgroundImage,0,0);
					context.drawImage(hero, heroLocation.x, heroLocation.y);
					context.drawImage(snitch, snitchLocation.x, snitchLocation.y);
					context.drawImage(bludger, bludgerLocation.x, bludgerLocation.y);
					requestAnimationFrame(draw);
				}

			draw();
			</script>

</body>
</html>